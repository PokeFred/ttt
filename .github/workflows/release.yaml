name: Release

on:
    push:
        branches:
            - main

jobs:
    release:
        strategy:
            fail-fast: false
        runs-on: ubuntu-22.04
        steps:
            -   name: checkout the repository
                uses: actions/checkout@v4.1.7
            -   name: setup linux dependencies
                run: sudo apt-get update && sudo apt-get install libwebkit2gtk-4.1-dev libappindicator3-dev librsvg2-dev patchelf -y
            -   name: setup nodejs
                uses: actions/setup-node@v4.0.3
                with:
                    node-version: 18
            -   name: setup rust
                uses: dtolnay/rust-toolchain@stable
            -   name: caching rust dependencies
                uses: swatinem/rust-cache@v2.7.3
                with:
                    workspaces: "./src-tauri -> target"
            -   name: install dependencies
                run: npm install
            -   name: build the project
                run: npm run build
            -   name:  release the build
                uses: actions/upload-artifact@v4.3.4
                with:
                    name: ttt-linux
                    path: /home/runner/work/ttt/ttt/src-tauri/target/release/app
